<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz App</title>
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; background: #000; color: #0ff; text-align: center; }
    h1 { text-shadow: 0 0 15px #0ff; }
    .container { padding: 20px; }
    .button { background: #0ff; color: #000; border: none; padding: 10px 20px; border-radius: 8px; margin: 5px; cursor: pointer; }
    .button:hover { background: #00f; color: #fff; }
    #quizCard, #subjectPage, #topicPage { display: none; }
    .options button { display: block; width: 100%; margin: 10px 0; }
    #wallet { font-size: 18px; margin-bottom: 10px; }
    #progressBarContainer { width: 100%; height: 8px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; margin-bottom: 10px; }
    #progressBar { width: 100%; height: 100%; background: #0ff; border-radius: 5px; transition: width 1s linear; }
    .footer { position: fixed; bottom: 0; width: 100%; background: rgba(20, 20, 20, 0.95); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #0ff; }
    .footer button { flex: 1; margin: 0 5px; padding: 10px; }
  </style>
</head>
<body>
  <h1>‚ö° Quiz App</h1>
  <div id="wallet">üí∞ Coins: <span id="coins">0</span></div>
  
  <div id="subjectPage" class="container">
    <h2>Select Subject</h2>
    <div id="subjectList"></div>
  </div>

  <div id="topicPage" class="container">
    <h2>Select Topic</h2>
    <div id="topicList"></div>
  </div>

  <div id="quizCard" class="container">
    <h2 id="question"></h2>
    <div id="timer">‚è± 10s</div>
    <div id="progressBarContainer"><div id="progressBar"></div></div>
    <div class="options" id="options"></div>
    <div id="solution" style="margin-top:10px; color:#0f0;"></div>
    <button class="button" onclick="nextQuestion()">Next</button>
  </div>

  <div id="referralPage" class="container" style="display:none;">
    <h2>Referral System</h2>
    <p>Your referral link:</p>
    <input type="text" id="refLink" readonly style="width:100%; text-align:center;">
    <p>Share this link with your friends! You earn 100 coins per referral.</p>
  </div>

  <div class="footer">
    <button onclick="showPage('subjectPage')">üìö Subjects</button>
    <button onclick="showPage('topicPage')">üìñ Topics</button>
    <button onclick="showPage('quizCard')">üìù Quiz</button>
    <button onclick="showPage('referralPage')">ü§ù Referral</button>
    <button onclick="showPage('walletPage')">üí∞ Wallet</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD0KSh__yrwZYDOKU85ltV-zOBpF6gLvm0",
      authDomain: "quizapp-f1224.firebaseapp.com",
      projectId: "quizapp-f1224",
      storageBucket: "quizapp-f1224.firebasestorage.app",
      messagingSenderId: "432922180972",
      appId: "1:432922180972:web:e816869f5efc03f32f4749",
      measurementId: "G-S3XZW4KSZ6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const subjectListEl = document.getElementById("subjectList");
    const topicListEl = document.getElementById("topicList");
    const questionEl = document.getElementById("question");
    const optionsEl = document.getElementById("options");
    const coinsEl = document.getElementById("coins");
    const solutionEl = document.getElementById("solution");
    const refLink = document.getElementById("refLink");

    let coins = parseInt(localStorage.getItem("coins") || "0");
    let questions = [];
    let currentIndex = 0;
    let timer = 10;
    let timerInterval;

    coinsEl.textContent = coins;

    function showPage(id) {
      document.getElementById("subjectPage").style.display = "none";
      document.getElementById("topicPage").style.display = "none";
      document.getElementById("quizCard").style.display = "none";
      document.getElementById("referralPage").style.display = "none";
      document.getElementById(id).style.display = "block";
    }

    async function loadSubjects() {
      const snap = await getDoc(doc(db, "data", "subjects"));
      subjectListEl.innerHTML = "";
      if (snap.exists()) {
        snap.data().list.forEach(sub => {
          const btn = document.createElement("button");
          btn.className = "button";
          btn.textContent = sub;
          btn.onclick = () => loadTopics(sub);
          subjectListEl.appendChild(btn);
        });
      }
    }

    function loadTopics(subject) {
      topicListEl.innerHTML = "";
      ["Topic 1", "Topic 2", "Topic 3"].forEach(t => {
        const btn = document.createElement("button");
        btn.className = "button";
        btn.textContent = t;
        btn.onclick = () => startQuiz();
        topicListEl.appendChild(btn);
      });
      showPage("topicPage");
    }

    async function startQuiz() {
      const snap = await getDoc(doc(db, "data", "quiz"));
      if (snap.exists()) {
        questions = snap.data().questions || [];
        currentIndex = 0;
        showQuestion();
        showPage("quizCard");
      }
    }

    function showQuestion() {
      if (currentIndex >= questions.length) {
        alert("Quiz Finished!");
        showPage("subjectPage");
        return;
      }
      const q = questions[currentIndex];
      questionEl.textContent = q.question;
      solutionEl.textContent = "";
      optionsEl.innerHTML = "";
      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.className = "button";
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(i);
        optionsEl.appendChild(btn);
      });
      startTimer();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timer = 10;
      document.getElementById("timer").textContent = `‚è± ${timer}s`;
      document.getElementById("progressBar").style.width = "100%";

      timerInterval = setInterval(() => {
        timer--;
        document.getElementById("timer").textContent = `‚è± ${timer}s`;
        document.getElementById("progressBar").style.width = `${(timer / 10) * 100}%`;
        if (timer <= 0) {
          clearInterval(timerInterval);
          nextQuestion();
        }
      }, 1000);
    }

    function checkAnswer(i) {
      const q = questions[currentIndex];
      if (i === q.answer) {
        coins++;
        solutionEl.style.color = "#0f0";
        solutionEl.textContent = "‚úÖ Correct! " + q.solution;
      } else {
        coins--;
        solutionEl.style.color = "#f00";
        solutionEl.textContent = "‚ùå Wrong! " + q.solution;
      }
      localStorage.setItem("coins", coins);
      coinsEl.textContent = coins;
    }

    function nextQuestion() {
      currentIndex++;
      showQuestion();
    }

    function setupReferral() {
      const userId = localStorage.getItem("userId") || Math.random().toString(36).substr(2, 9);
      localStorage.setItem("userId", userId);
      refLink.value = `${window.location.origin}?ref=${userId}`;

      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get("ref");
      if (ref && ref !== userId && !localStorage.getItem("refGiven")) {
        coins += 100;
        localStorage.setItem("coins", coins);
        coinsEl.textContent = coins;
        localStorage.setItem("refGiven", "true");
        alert("üéÅ You received 100 coins from referral!");
      }
    }

    loadSubjects();
    setupReferral();
    showPage("subjectPage");
  </script>
</body>
</html>
